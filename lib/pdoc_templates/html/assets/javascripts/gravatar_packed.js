if(typeof MooTools=="undefined"){throw"MooTools must be loaded in order to use Gravatar!"}if(typeof Bounga.MD5=="undefined"){throw"Bounga.MD5 must be loaded in order to use Gravatar!"}if(typeof Bounga=="undefined"){Bounga={}}Bounga.Gravatar=new Class({Implements:[Options,Events],options:{size:100,extension:".jpg",rating:"g",defaultImage:null},initialize:function(C,B){this.setOptions(B);this.email=C.trim();this.md5=this.email.toMD5();var A=["http://www.gravatar.com/avatar/",this.md5,this.options.extension,"?s=",this.options.size,"&r=",this.options.rating];if(this.options.defaultImage!=null){A.push("&d=");A.push(encodeURI(this.options.defaultImage))}this.url=A.join("");this._fetchProfile();var D=(this.profile!=null?this.profile.entry[0].preferredUsername:"User")+"'s Avatar";this.to_img=new Element("img",{src:this.url,alt:D});return this},_fetchProfile:function(){if(this.options.profileURL!=null){new Request.JSON({url:"http://www.gravatar.com/"+this.md5+".json",onSuccess:function(A){this.profile=A;this.fireEvent("profileFetched")}.bind(this),onFailure:function(){if(console){console.log("Bounga.Gravatar profile fetching error");console.log(this.options.profileURL+this.md5+".json");this.fireEvent("profileFetchingFailed")}}.bind(this)}).get()}}});